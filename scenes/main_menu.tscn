[gd_scene load_steps=23 format=3 uid="uid://cypwqksg1qrc5"]

[ext_resource type="Texture2D" uid="uid://b156cmxm1wmhe" path="res://assets/skybox/bg.png" id="1_l6cm7"]
[ext_resource type="Texture2D" uid="uid://qymy4et4jfcg" path="res://assets/sprites/VerticleHUD.svg" id="2_8ln24"]
[ext_resource type="Texture2D" uid="uid://btbnj4v1qq3v1" path="res://assets/skybox/bg2.png" id="2_rtw2f"]
[ext_resource type="Texture2D" uid="uid://cayw6362tw6y1" path="res://assets/skybox/cockpit.png" id="2_wu84c"]
[ext_resource type="Material" uid="uid://dg1x6fpusyufh" path="res://assets/shaders/scanline.tres" id="3_wu84c"]
[ext_resource type="PackedScene" uid="uid://dp3rvhbvdll7k" path="res://scenes/miniscreen.tscn" id="4_8ln24"]
[ext_resource type="AudioStream" uid="uid://mn1w3ulxq6jq" path="res://assets/sounds/warp_start.wav" id="7_oa1go"]
[ext_resource type="AudioStream" uid="uid://dkmbw86ugmupy" path="res://assets/music/main_menu.ogg" id="8_tbmy8"]

[sub_resource type="Animation" id="Animation_5dd4i"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:scale")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(0.666751, 0.666751)]
}

[sub_resource type="Animation" id="Animation_jk1qb"]
resource_name = "woosh"
length = 60.0
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:scale")
tracks/0/interp = 2
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 28.2333, 59.4724),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 0,
"values": [Vector2(0.637, 0.637), Vector2(2.037, 2.037), Vector2(0.637, 0.637)]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_lgwnu"]
_data = {
&"RESET": SubResource("Animation_5dd4i"),
&"woosh": SubResource("Animation_jk1qb")
}

[sub_resource type="ViewportTexture" id="ViewportTexture_wu84c"]
viewport_path = NodePath("FG/SubViewport")

[sub_resource type="Animation" id="Animation_oa1go"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:material:shader_parameter/rgb_offset_uv")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [0.002]
}

[sub_resource type="Animation" id="Animation_rtw2f"]
resource_name = "jigglergb"
length = 23.732
loop_mode = 1
step = 0.0
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:material:shader_parameter/rgb_offset_uv")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 1.32095, 1.36016, 1.45428, 2.17533, 2.1977, 2.23378, 2.79012, 2.8125, 2.84858, 5.8577, 5.88007, 5.91616, 6.59677, 6.65225, 6.71367, 9.01056, 9.03293, 9.06901, 9.61707, 9.67254, 9.73396, 13.5553, 13.5777, 13.6138, 16.8266, 16.882, 16.9435, 17.4824, 17.5379, 17.5993, 18.283, 18.3054, 18.3415, 21.8217, 21.8441, 21.8802, 22.5608, 22.6163, 22.6777),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
"update": 0,
"values": [0.002, 0.002, 0.057, 0.002, 0.002, 0.005, 0.002, 0.002, 0.005, 0.002, 0.002, 0.005, 0.002, 0.002, -0.002, 0.002, 0.002, 0.005, 0.002, 0.002, -0.002, 0.002, 0.002, 0.005, 0.002, 0.002, -0.002, 0.002, 0.002, -0.002, 0.002, 0.002, 0.005, 0.002, 0.002, 0.005, 0.002, 0.002, -0.002, 0.002]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_tbmy8"]
_data = {
&"RESET": SubResource("Animation_oa1go"),
&"jigglergb": SubResource("Animation_rtw2f")
}

[sub_resource type="GDScript" id="GDScript_l6cm7"]
resource_name = "cameraparallax"
script/source = "extends Camera2D
class_name CameraController
signal zoom_in

@export var container: Node = null
@export var move_speed_factor: float = 1.2
@export var zoom_speed_factor: float = 1
@onready var screen_center: Vector2 = get_viewport().get_visible_rect().size / 2

@export var start:Button

@export var mouse_hide_time: float = 3.0

var target_zoom: Vector2 = Vector2(1, 1)
var time_until_snapback: float = 0

var time_since_mouse: float = 0

func _ready() -> void:
	position = screen_center
	Input.set_mouse_mode(Input.MOUSE_MODE_HIDDEN)

var zoomed = false
func _process(delta: float) -> void:
	if get_window().has_focus() and time_since_mouse < mouse_hide_time:
		time_since_mouse += delta
		if time_since_mouse >= mouse_hide_time:
			Input.mouse_mode = Input.MOUSE_MODE_HIDDEN
	
	if zoomed:
		return
	var mouse_pos: Vector2 = get_viewport().get_mouse_position()
	var offset_vec: Vector2 = mouse_pos - position
	var distance: float = offset_vec.length()
	
	var speed: float = distance * move_speed_factor
	if speed < 10:
		speed = 10
	
	position = position.move_toward(mouse_pos, delta * speed)
	
	if time_until_snapback > 0:
		time_until_snapback -= delta
		zoom = zoom.move_toward(target_zoom, delta * zoom_speed_factor)
		if time_until_snapback <= 0:
			zoom = Vector2(1, 1)
			time_until_snapback = 0
	
	if Input.is_anything_pressed():
		$AnimationPlayer.play(\"zoom\")
		zoomed = true
		


func zoom_and_snap_back(duration: float) -> void:
	target_zoom = Vector2(2, 2)
	time_until_snapback = duration
	
func fettsack():
	zoom_in.emit()
	

func _input(event: InputEvent) -> void:
	if event is InputEventMouseMotion or event is InputEventMouseButton:
		Input.mouse_mode = Input.MOUSE_MODE_VISIBLE
		time_since_mouse = 0
	
	$\"../../FG/SubViewport\".push_input(event,false)


func _on_control_zoomout() -> void:
	$AnimationPlayer.play(\"zoomback\")
	
func change_scene_usw():
	if container.iJoinedNotHosted:
		NetworkManager.join_game(NetworkManager.DEFAULT_SERVER_IP)
		return
	
	NetworkManager.host_game()
	ScoreManager.current_team_name = container.teamname
	
	# TODO container.hexkot
	# container.hexkot_secondary
	
	#TODO - add in correct place:
	#func game_over():
	#	if multiplayer.is_server():
	#	ScoreManager.save_current_run()
	
	
"

[sub_resource type="Animation" id="Animation_8ln24"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:zoom")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(1, 1)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath(".:offset")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(0, 0)]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("../../BG/BGAfter:visible")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("../../BG/BGAfter:scale")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(0.803769, 0.803769)]
}
tracks/4/type = "value"
tracks/4/imported = false
tracks/4/enabled = true
tracks/4/path = NodePath("../../FADETOWHITE:modulate")
tracks/4/interp = 1
tracks/4/loop_wrap = true
tracks/4/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Color(1, 1, 1, 1)]
}
tracks/5/type = "value"
tracks/5/imported = false
tracks/5/enabled = true
tracks/5/path = NodePath("../../BG/BGAfter:modulate")
tracks/5/interp = 1
tracks/5/loop_wrap = true
tracks/5/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Color(1, 1, 1, 1)]
}
tracks/6/type = "value"
tracks/6/imported = false
tracks/6/enabled = true
tracks/6/path = NodePath("../../FADETOWHITE:visible")
tracks/6/interp = 1
tracks/6/loop_wrap = true
tracks/6/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/7/type = "value"
tracks/7/imported = false
tracks/7/enabled = true
tracks/7/path = NodePath("../../MusicPlayer:volume_db")
tracks/7/interp = 1
tracks/7/loop_wrap = true
tracks/7/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [-5.0]
}

[sub_resource type="Animation" id="Animation_wu84c"]
resource_name = "zoom"
length = 1.387
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:zoom")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0.666667, 1.26667),
"transitions": PackedFloat32Array(7.21, 1),
"update": 0,
"values": [Vector2(1, 1), Vector2(4.725, 4.725)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath(".:offset")
tracks/1/interp = 2
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0.2, 1.26667),
"transitions": PackedFloat32Array(1, 0.196146),
"update": 0,
"values": [Vector2(0, 0), Vector2(-4448.4, 951.81)]
}
tracks/2/type = "method"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath(".")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(1.23333),
"transitions": PackedFloat32Array(1),
"values": [{
"args": [],
"method": &"fettsack"
}]
}

[sub_resource type="Animation" id="Animation_tbmy8"]
resource_name = "zoomback"
length = 9.0
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:zoom")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0.4, 2.46667),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [Vector2(4.725, 4.725), Vector2(1, 1)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath(".:offset")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0.3, 2.76667),
"transitions": PackedFloat32Array(0.196146, 1),
"update": 0,
"values": [Vector2(-4448.4, 951.81), Vector2(0, 0)]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("../../BG/BGAfter:visible")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0.5, 0.7),
"transitions": PackedFloat32Array(1, 1),
"update": 1,
"values": [false, true]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("../../BG/BGAfter:scale")
tracks/3/interp = 2
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(2.66667, 3.88, 5.73333),
"transitions": PackedFloat32Array(1, 1, 3.36359),
"update": 0,
"values": [Vector2(0.803769, 0.803769), Vector2(0.80922, 0.80922), Vector2(1.159, 1.159)]
}
tracks/4/type = "value"
tracks/4/imported = false
tracks/4/enabled = true
tracks/4/path = NodePath("../../FADETOWHITE:modulate")
tracks/4/interp = 1
tracks/4/loop_wrap = true
tracks/4/keys = {
"times": PackedFloat32Array(4, 5.6),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [Color(1, 1, 1, 0), Color(1, 1, 1, 1)]
}
tracks/5/type = "value"
tracks/5/imported = false
tracks/5/enabled = true
tracks/5/path = NodePath("../../BG/BGAfter:modulate")
tracks/5/interp = 1
tracks/5/loop_wrap = true
tracks/5/keys = {
"times": PackedFloat32Array(0.666667, 0.933333),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [Color(1, 1, 1, 0), Color(1, 1, 1, 1)]
}
tracks/6/type = "value"
tracks/6/imported = false
tracks/6/enabled = true
tracks/6/path = NodePath("../../FADETOWHITE:visible")
tracks/6/interp = 1
tracks/6/loop_wrap = true
tracks/6/keys = {
"times": PackedFloat32Array(2.93333, 3.73333),
"transitions": PackedFloat32Array(1, 1),
"update": 1,
"values": [false, true]
}
tracks/7/type = "method"
tracks/7/imported = false
tracks/7/enabled = true
tracks/7/path = NodePath(".")
tracks/7/interp = 1
tracks/7/loop_wrap = true
tracks/7/keys = {
"times": PackedFloat32Array(5.76667),
"transitions": PackedFloat32Array(1),
"values": [{
"args": [],
"method": &"change_scene_usw"
}]
}
tracks/8/type = "audio"
tracks/8/imported = false
tracks/8/enabled = true
tracks/8/path = NodePath("WarpSound")
tracks/8/interp = 1
tracks/8/loop_wrap = true
tracks/8/keys = {
"clips": [{
"end_offset": 0.0,
"start_offset": 0.0,
"stream": ExtResource("7_oa1go")
}],
"times": PackedFloat32Array(0.96666664)
}
tracks/8/use_blend = true
tracks/9/type = "value"
tracks/9/imported = false
tracks/9/enabled = true
tracks/9/path = NodePath("../../MusicPlayer:volume_db")
tracks/9/interp = 1
tracks/9/loop_wrap = true
tracks/9/keys = {
"times": PackedFloat32Array(3, 5.733333),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [-5.0, -80.0]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_8ln24"]
_data = {
&"RESET": SubResource("Animation_8ln24"),
&"zoom": SubResource("Animation_wu84c"),
&"zoomback": SubResource("Animation_tbmy8")
}

[sub_resource type="Gradient" id="Gradient_rtw2f"]
offsets = PackedFloat32Array(1)
colors = PackedColorArray(1, 1, 1, 1)

[sub_resource type="GradientTexture2D" id="GradientTexture2D_oa1go"]
gradient = SubResource("Gradient_rtw2f")

[node name="MainMenu" type="Control"]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="BG" type="Parallax2D" parent="."]
scroll_scale = Vector2(0.1, 0.1)

[node name="BG" type="Sprite2D" parent="BG"]
position = Vector2(596, 266)
scale = Vector2(0.666751, 0.666751)
texture = ExtResource("1_l6cm7")

[node name="AnimationPlayer" type="AnimationPlayer" parent="BG/BG"]
libraries = {
&"": SubResource("AnimationLibrary_lgwnu")
}
autoplay = "woosh"

[node name="BGAfter" type="Sprite2D" parent="BG"]
visible = false
position = Vector2(593, 214)
scale = Vector2(0.803769, 0.803769)
texture = ExtResource("2_rtw2f")

[node name="cockpithud" type="Parallax2D" parent="."]
scroll_scale = Vector2(0.07, 0.07)

[node name="SvgviewerOutput" type="Sprite2D" parent="cockpithud"]
position = Vector2(593, 241)
scale = Vector2(0.14078, 0.14078)
texture = ExtResource("2_8ln24")
region_enabled = true
region_rect = Rect2(0, 705.483, 400, 852.151)

[node name="FG" type="Parallax2D" parent="."]
scroll_scale = Vector2(0.05, 0.05)

[node name="FG" type="Sprite2D" parent="FG"]
position = Vector2(587, 323)
scale = Vector2(0.931855, 0.931855)
texture = ExtResource("2_wu84c")

[node name="TextureRect" type="TextureRect" parent="FG"]
material = ExtResource("3_wu84c")
offset_left = 257.0
offset_top = 321.0
offset_right = 1457.0
offset_bottom = 1321.0
rotation = -0.017827
scale = Vector2(0.157008, 0.153548)
texture = SubResource("ViewportTexture_wu84c")

[node name="AnimationPlayer" type="AnimationPlayer" parent="FG/TextureRect"]
libraries = {
&"": SubResource("AnimationLibrary_tbmy8")
}
autoplay = "jigglergb"
speed_scale = 0.75

[node name="SubViewport" type="SubViewport" parent="FG"]
size = Vector2i(1200, 1000)
render_target_update_mode = 4

[node name="Control" parent="FG/SubViewport" instance=ExtResource("4_8ln24")]

[node name="LineEdit" parent="FG/SubViewport/Control/HOSTINGASHOST" index="3"]
select_all_on_focus = false

[node name="LineEdit2" parent="FG/SubViewport/Control/HOSTINGASHOST" index="5"]
select_all_on_focus = false

[node name="LineEdit3" parent="FG/SubViewport/Control/HOSTINGASHOST" index="8"]
select_all_on_focus = false

[node name="Node2D" type="Node2D" parent="."]

[node name="Camera2D" type="Camera2D" parent="Node2D" node_paths=PackedStringArray("container")]
position = Vector2(572, 465.665)
script = SubResource("GDScript_l6cm7")
container = NodePath("../../FG/SubViewport/Control/HOSTINGASHOST/START")

[node name="AnimationPlayer" type="AnimationPlayer" parent="Node2D/Camera2D"]
libraries = {
&"": SubResource("AnimationLibrary_8ln24")
}

[node name="WarpSound" type="AudioStreamPlayer" parent="Node2D/Camera2D"]
volume_db = -5.0
bus = &"SFX"

[node name="FADETOWHITE" type="Sprite2D" parent="."]
visible = false
scale = Vector2(157.661, 83.9539)
texture = SubResource("GradientTexture2D_oa1go")

[node name="MusicPlayer" type="AudioStreamPlayer" parent="."]
stream = ExtResource("8_tbmy8")
volume_db = -5.0
autoplay = true
bus = &"Music"
parameters/looping = true

[connection signal="zoomout" from="FG/SubViewport/Control" to="Node2D/Camera2D" method="_on_control_zoomout"]
[connection signal="focus_entered" from="FG/SubViewport/Control/HOSTINGASHOST/LineEdit" to="FG/SubViewport/Control/HOSTINGASHOST" method="_on_line_edit_focus_entered"]
[connection signal="focus_entered" from="FG/SubViewport/Control/HOSTINGASHOST/LineEdit2" to="FG/SubViewport/Control/HOSTINGASHOST" method="_on_line_edit_2_focus_entered"]
[connection signal="focus_entered" from="FG/SubViewport/Control/HOSTINGASHOST/LineEdit3" to="FG/SubViewport/Control/HOSTINGASHOST" method="_on_line_edit_3_focus_entered"]
[connection signal="zoom_in" from="Node2D/Camera2D" to="FG/SubViewport/Control" method="_on_zoomin"]

[editable path="FG/SubViewport/Control"]
